import random
from socket import *
username = ""
users = []
c_sock = socket(AF_INET, SOCK_STREAM)
s_name = "localhost"
s_port = 12000
c_sock.connect((s_name, s_port))
encoding = 'utf-8'
def generate_username(un):
    response = 0
    un += "#...."
    while response < 1:
        un = un[:-4]
        for _ in range(4):
            un += str(random.randint(0,9))
        print(f"Sending {un}")
        c_sock.send(bytes(un,encoding))
        response = int(c_sock.recv(1024).decode(encoding))
        print(f"Response: {response}")
    return un

def send_message(user, message):
    c_sock.send(bytes())
def exit():
    pass

if __name__ == "__main__":
    username = generate_username(input("Please enter your name, or some username. Do not include numbers, as these will be randomly assigned for uniqueness\n"))
    welcome = c_sock.recv(1024).decode(encoding)
    print(welcome)
    users = welcome.split(sep = "\n")[1:-1]
    while 1:
        msg = input()
        if msg == "users":
            print(users)
        elif msg == "exit":
            exit()
        else:
            hashtag = msg.index("#")
            if hashtag == -1:
                print("Invalid message. type \"users\" to see available users, \"exit\" to exit, or a username (or simply their number) followed by the message you would like to send!")
            else:
                user = msg[:hashtag + 5]
                msg = msg[hashtag + 4:]
                if user in users:
                    send_message(user,msg)
                else:
                    print("That is not a valid user. Either they left the chat, or they never existed!")